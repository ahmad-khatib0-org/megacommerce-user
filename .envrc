use_gvm_for_go() {
  [ -f go.mod ] || return 0
  ver=$(awk '/^go /{print $2; exit}' go.mod)
  [ -n "$ver" ] || return 0

  # Source gvm environment from the correct location
  if [ -s "$HOME/.gvm/scripts/gvm" ]; then
    source "$HOME/.gvm/scripts/gvm"
  else
    echo "gvm not found at $HOME/.gvm/scripts/gvm"
    return 1
  fi

  # Now use gvm commands
  if ! gvm list | grep -q "go${ver}"; then
    echo "gvm: installing go${ver}..."
    gvm install "go${ver}"
  fi

  gvm use "go${ver}"
}

use_gvm_for_go
