# Multi-stage build for Go service
FROM golang:1.24-alpine AS base

WORKDIR /app

ENV ENV=dev \
    CGO_ENABLED=1 \
    GOOS=linux

# Install build dependencies
RUN apk add --no-cache gcc musl-dev postgresql-client curl bash

# Dependencies stage
FROM base AS deps

COPY go.mod go.sum ./
RUN go mod download

# Development stage
FROM base AS dev

COPY go.mod go.sum ./
RUN go mod download

# Install air for hot reload
RUN go install github.com/air-verse/air@v1.61.7

COPY . .

EXPOSE 50052

CMD ["air", "-c", ".air.toml"]
